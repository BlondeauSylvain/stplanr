<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Origin-destination data in R: examples with stplanr • stplanr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- ropensci --><link href="../ropensci.css" rel="stylesheet">
<meta property="og:title" content="Origin-destination data in R: examples with stplanr">
<meta property="og:description" content="">
<meta property="og:image" content="https://ropensci.github.io/stplanr/logo.png">
<meta name="twitter:card" content="summary">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-462421-8"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-462421-8');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://ropensci.org"><img src="../hexlogo.png" id="hexlogo" alt="rOpenSci"></a>
        <a class="navbar-brand" href="../index.html"><i>stplanr <small>v0.2.10.9000</small></i></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/stplanr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stplanr-od.html">Origin-destination data in R: examples with stplanr</a>
    </li>
    <li>
      <a href="../articles/stplanr-paper.html">stplanr: A Package for Transport Planning</a>
    </li>
    <li>
      <a href="../articles/stplanr-route-nets.html">Route networks with stplanr</a>
    </li>
    <li>
      <a href="../articles/stplanr-routing.html">Transport routing with stplanr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ropensci/stplanr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Origin-destination data in R: examples with stplanr</h1>
                        <h4 class="author">Robin Lovelace</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/stplanr/blob/master/vignettes/stplanr-od.Rmd"><code>vignettes/stplanr-od.Rmd</code></a></small>
      <div class="hidden name"><code>stplanr-od.Rmd</code></div>

    </div>

    
    
<div id="introduction-what-is-od-data" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-what-is-od-data" class="anchor"></a>Introduction: what is OD data?</h1>
<p>Origin-destination (OD) data is data that has not just one geographic location, but two. As the name suggests, OD data represents movement through geographic space, from an origin (O) to a destination (D). Despite the rather dull name, OD datasets are a vital part of the modern world, underpinning the transport models that influence current <em>and future</em> systems. If you, like many others, are frustrated by the car dominated nature of most cities, OD datasets should be of great interest: they underlied the car-centric transport models that were helped inform and justify the vast expansion of highways that happened in the 20<sup>th</sup> Century <span class="citation">(Boyce and Williams 2015)</span>.</p>
<p>If you are under any illusion that this healthy outcome of 20<sup>th</sup> Century transport planning, consider this: roads are now the largest cause of death and injury for young people worldwide, killing and maiming more than more than 1 million and 10 million people each year according to data from the <a href="https://www.who.int/violence_injury_prevention/road_safety_status/2018/en/">World Health Organization</a>. Even ignoring other problems such as air pollution, an obesity crisis driven by physical inactivity and climate change, it is clear that current transport systems, and the models that have helped to design them, are unsustainable. There are other reasons why transport data analysis is important, as outlined in the ‘stplanr paper’ <span class="citation">(Lovelace and Ellison 2018)</span>.</p>
<p>The purpose of this paper is to provide an introduction to OD paper, with examples based on data and functions from the stplanr package. OD data can be accessed from a range of sources (we will see code that downloads millions of OD pairs later in this vignette). Generally you will need to do some ‘data carpentry’ before the OD data is ‘clean’ and ready for analysis. This vignette will not cover cleaning OD, we assume you know R and come with clean (if not ‘tidy’) data!</p>
<p>In simple terms OD data looks like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(stplanr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">od =<span class="st"> </span>pct<span class="op">::</span>wight_od <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">matches</a></span>(<span class="st">"rail|name|moto|car|tax|home"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span>(<span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">wt =</span> all)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(od)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">od</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; # A tibble: 5 x 8</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt;   geo_code1 geo_code2   all train   bus bicycle  foot other</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt; 1 E02003589 E02003588   809     0    32      47   283     2</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; 2 E02003589 E02003589   875     0    12      35   581     3</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; 3 E02003591 E02003588   831     1    14      70   145     1</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt; 4 E02003591 E02003589   852     1     6      38   457     1</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt; 5 E02003592 E02003592  1164     1    41      72   439     5</span></a></code></pre></div>
<p>The next section discusses this, and other, representations of OD data.</p>
</div>
<div id="representations-of-od-data" class="section level1">
<h1 class="hasAnchor">
<a href="#representations-of-od-data" class="anchor"></a>Representations of OD data</h1>
<p>Like all datasets the object <code>od</code>, created in the preceding code chunk, comes from a specific context: the 2011 <a href="https://census.ukdataservice.ac.uk/media/50966/2011_england_household.pdf">UK Census</a> questions:</p>
<ul>
<li>In your main job, what is the address of your workplace?</li>
<li>How do you usually travel to work (for the longest part, by distance, of your usual journey to work)?
<ul>
<li>Work mainly at or from home</li>
<li>Underground, metro, light rail, tram</li>
<li>Train</li>
<li>…</li>
</ul>
</li>
</ul>
<p>The object <code>od</code> contains aggregated answers to these question, counting how many people travel from each origin zone to each destination zone, in the ‘long’ form, where each row is an ‘od pair’. OD data can also bee represented as an ‘OD matrix’, as illustrated below withe the <strong>stplanr</strong> function <code><a href="../reference/od_to_odmatrix.html">od_to_odmatrix()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">od_matrix =<span class="st"> </span><span class="kw"><a href="../reference/od_to_odmatrix.html">od_to_odmatrix</a></span>(od[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(od_matrix)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; [1] "matrix"</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">od_matrix</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt;           E02003588 E02003589 E02003592</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; E02003589       809       875        NA</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; E02003591       831       852        NA</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; E02003592        NA        NA      1164</span></a></code></pre></div>
<p>Intead of creating a new column for each <em>OD pair</em>, this matrix representation creates a new row for each <em>zone of origin</em>. It is a simpler data structure, containing only counts, and was popular in the origin origins of transport planning: ‘OD matrix’ is still sometimes used informally to any OD data. However, I recommend using the long OD pair representation: OD matrices become unwieldy for large OD datasets, which are likely to be sparse, with many NAs. Furthermore, multiple lists of OD matrices or ‘OD arrays’ must be created to represent multiple attributes. This is demonstrated in the code chunk below, which represents travel between OD pairs by all modes and by bike:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"all"</span>, <span class="st">"bicycle"</span>), <span class="cf">function</span>(x) <span class="kw"><a href="../reference/od_to_odmatrix.html">od_to_odmatrix</a></span>(od[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"geo_code1"</span>, <span class="st">"geo_code2"</span>, x)]))</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt;           E02003588 E02003589 E02003592</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; E02003589       809       875        NA</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; E02003591       831       852        NA</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; E02003592        NA        NA      1164</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt;           E02003588 E02003589 E02003592</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; E02003589        47        35        NA</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; E02003591        70        38        NA</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; E02003592        NA        NA        72</span></a></code></pre></div>
<p>The function <code><a href="../reference/odmatrix_to_od.html">odmatrix_to_od()</a></code> can help get your data into the more convenient long form:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/odmatrix_to_od.html">odmatrix_to_od</a></span>(od_matrix)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt;        orig      dest flow</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; 1 E02003589 E02003588  809</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; 4 E02003589 E02003589  875</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; 2 E02003591 E02003588  831</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; 5 E02003591 E02003589  852</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; 9 E02003592 E02003592 1164</span></a></code></pre></div>
<p>Another common (and sometimes problematic) feature of OD data is ‘intra-zonal flows’. These are trips that start and end in the same zone. It is often useful to separate intra-zonal and inter-zonal flows at the outset, as demonstrated below:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">(<span class="dt">od_inter =</span> od <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(geo_code1 <span class="op">!=</span><span class="st"> </span>geo_code2))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; # A tibble: 3 x 8</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt;   geo_code1 geo_code2   all train   bus bicycle  foot other</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; 1 E02003589 E02003588   809     0    32      47   283     2</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; 2 E02003591 E02003588   831     1    14      70   145     1</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt; 3 E02003591 E02003589   852     1     6      38   457     1</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">(<span class="dt">od_intra =</span> od <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(geo_code1 <span class="op">==</span><span class="st"> </span>geo_code2))</a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; # A tibble: 2 x 8</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt;   geo_code1 geo_code2   all train   bus bicycle  foot other</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt; 1 E02003589 E02003589   875     0    12      35   581     3</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; 2 E02003592 E02003592  1164     1    41      72   439     5</span></a></code></pre></div>
<div id="origin-destination-pairs-long-form" class="section level2">
<h2 class="hasAnchor">
<a href="#origin-destination-pairs-long-form" class="anchor"></a>Origin-destination pairs (long form)</h2>
<p>Perhaps the most common and straightforward representation of OD data is a ‘long thin’ data frame. This is increasingly the format used by official statistical agencies, including the UK’s Office for National Statistics (ONS), who provide origin destination data as a <code>.csv</code> file. Typically, the first column is the zone code of origin and the second column is the zone code of the destination, as shown in the code chunk below, which creates an object called <code>od_data_sample</code> using the <a href="https://itsleeds.github.io/pct/"><code>pct</code> package</a> (chunk not evaluated for speed):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"ITSLeeds/pct"</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(pct)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">od_data_all =<span class="st"> </span>pct<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/pct/topics/get_od">get_od</a></span>()</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">sel_local =<span class="st"> </span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">  </span>od_data_all<span class="op">$</span>geo_code1 <span class="op">%in%</span><span class="st"> </span>cents_sf<span class="op">$</span>geo_code <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span>od_data_all<span class="op">$</span>geo_code2 <span class="op">%in%</span><span class="st"> </span>cents_sf<span class="op">$</span>geo_code </a>
<a class="sourceLine" id="cb6-7" data-line-number="7">od_data_sample =<span class="st"> </span>od_data_all[sel_local, ]</a></code></pre></div>
<p>Data in this form usually has at least one other colum, representing the amount of travel between the zones. Additional columns represent addition attributes, e.g. a breakdown of flow by time, mode of travel, type of person, or trip purpose. As shown in the output of printing the sample dataset, the dataset we have downloaded contains column names representing mode of travel (car, bicycle etc):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(od_data_sample)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt;  [1] "geo_code1"     "geo_code2"     "all"           "from_home"    </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt;  [5] "light_rail"    "train"         "bus"           "taxi"         </span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt;  [9] "motorbike"     "car_driver"    "car_passenger" "bicycle"      </span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; [13] "foot"          "other"         "geo_name1"     "geo_name2"    </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; [17] "la_1"          "la_2"</span></a></code></pre></div>
<p>Each ‘mode’ column contains an integer, while additional columns contain characters, as demonstrated by printing the data frame:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">od_data_sample</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; # A tibble: 64 x 18</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt;    geo_code1 geo_code2   all from_home light_rail train   bus  taxi</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt;    &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt;  1 E02002361 E02002361   109         0          0     0     4     2</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt;  2 E02002361 E02002363    38         0          0     1     4     1</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt;  3 E02002361 E02002367    10         0          0     0     1     0</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;  4 E02002361 E02002371    44         0          0     0     2     2</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt;  5 E02002361 E02002377    34         0          0     0     0     1</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt;  6 E02002361 E02002382     7         0          0     0     1     0</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt;  7 E02002361 E02002384    53         0          0     1    10     1</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;  8 E02002361 E02002393    94         0          0     0    17     1</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;  9 E02002363 E02002361    30         0          0     0     0     1</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; 10 E02002363 E02002363   183         0          0     2    13     3</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; # … with 54 more rows, and 10 more variables: motorbike &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; #   car_driver &lt;dbl&gt;, car_passenger &lt;dbl&gt;, bicycle &lt;dbl&gt;, foot &lt;dbl&gt;,</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt; #   other &lt;dbl&gt;, geo_name1 &lt;chr&gt;, geo_name2 &lt;chr&gt;, la_1 &lt;chr&gt;, la_2 &lt;chr&gt;</span></a></code></pre></div>
</div>
<div id="origin-destination-matrices" class="section level2">
<h2 class="hasAnchor">
<a href="#origin-destination-matrices" class="anchor"></a>Origin destination matrices</h2>
</div>
<div id="desire-lines" class="section level2">
<h2 class="hasAnchor">
<a href="#desire-lines" class="anchor"></a>Desire lines</h2>
<p>The previous two representations of OD data are ‘implicitly geographic’: their coordinates are not contained in the data, but associated with another data object, typically a zone or a zone centroid. This is clearly problematic because it makes OD data less modular and self standing. A useful way of representing OD data that overcomes this issue is <code>desire_line</code> data: geographic lines between origin and destination, with information on flow levels between the two.</p>
<p>This is represented in the file <code>lines_cars.Rds</code>, representing the top 20,000 desire lines at the MSOA-MSOA level in England and Wales by the number of car km used for travel to work, which can be downloaded, read-in and plotted as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">u =<span class="st"> "https://github.com/ropensci/stplanr/releases/download/0.2.9/lines_cars.Rds"</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">f =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempdir</a></span>(), <span class="st">"lines_cars.Rds"</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/download.file">download.file</a></span>(u, f)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">lines_cars =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readRDS">readRDS</a></span>(f)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(lines_cars[<span class="st">"car_km"</span>], <span class="dt">lwd =</span> lines_cars<span class="op">$</span>car_km <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>)</a></code></pre></div>
<p>Based on the estimate of the average energy use per km being 2.5 MJ, and that these return trips are made on average 200 times per year, with a circuity of 1.3, we can estimate the total energy use of the ‘high energy commutes’ as follows:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(lines_cars<span class="op">$</span>car_km <span class="op">*</span><span class="st"> </span><span class="fl">2.5</span> <span class="op">*</span><span class="st"> </span><span class="dv">200</span>) <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span></a></code></pre></div>
<p>That represents ~10 petajoules (PJ), only for the top 20,000 most energy intensive commutes. That may seem like alot, but represents only a fraction of the UK’s total energy use of <a href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/729451/DUKES_PN.pdf">~200 Mtoe</a> (8400 PJ).</p>
<div id="refs" class="references">
<div id="ref-boyce_forecasting_2015">
<p>Boyce, David E., and Huw C. W. L. Williams. 2015. <em>Forecasting Urban Travel: Past, Present and Future</em>. Edward Elgar Publishing.</p>
</div>
<div id="ref-lovelace_stplanr_2018">
<p>Lovelace, Robin, and Richard Ellison. 2018. “Stplanr: A Package for Transport Planning.” <em>The R Journal</em> 10 (2): 7–23. <a href="https://doi.org/10.32614/RJ-2018-053" class="uri">https://doi.org/10.32614/RJ-2018-053</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction-what-is-od-data">Introduction: what is OD data?</a></li>
      <li>
<a href="#representations-of-od-data">Representations of OD data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#origin-destination-pairs-long-form">Origin-destination pairs (long form)</a></li>
      <li><a href="#origin-destination-matrices">Origin destination matrices</a></li>
      <li><a href="#desire-lines">Desire lines</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div style="margin-top:-9px">
  <p>stplanr is a part of <img src="https://github.com/ropensci/logos/raw/master/icon_lettering_color.png" height="40" alt="rOpenSci">. Learn more at <a href="https://ropensci.org">ropensci.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by Robin Lovelace, Richard Ellison, Malcolm Morgan.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a> &amp; <a href="https://docs.ropensci.org/rotemplate/">rotemplate</a>.
  </p>
</div>
      </footer>
</div>

  

  </body>
</html>
