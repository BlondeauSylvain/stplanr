<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Aggregate OD data between polygon geometries — od_aggregate • stplanr</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />
<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<link href="../ropensci.css" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>
<link href="../tidyverse-2.css" rel="stylesheet">



<meta property="og:title" content="Aggregate OD data between polygon geometries — od_aggregate" />

<meta property="og:description" content="Aggregate OD data between polygon geometries" />

<meta property="og:image" content="https://ropensci.github.io/stplanr/logo.png" />
<meta name="twitter:card" content="summary" />



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">stplanr</a>
        <div class="info">
          <span class="partof">part of  <a href="https://ropensci.org"><img src='https://d33wubrfki0l68.cloudfront.net/88338b7637e084df5c43e7a9e6293719dbaf10e2/30903/img/icon_lettering_white.svg' height=24 alt = 'rOpenSci'/></a></span>
          <span class="version label label-default version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.8</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/stplanr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/stplanr-paper.html">stplanr: A Package for Transport Planning</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ropensci/stplanr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregate OD data between polygon geometries</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/stplanr/blob/master/R/aggregate_funs.R'><code>R/aggregate_funs.R</code></a></small>
    <div class="hidden name"><code>od_aggregate.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Aggregate OD data between polygon geometries</p>
    
    </div>

    <pre class="usage"><span class='fu'>od_aggregate</span>(<span class='no'>flow</span>, <span class='no'>zones</span>, <span class='no'>aggzones</span>, <span class='kw'>aggzone_points</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>aggcols</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>FUN</span> <span class='kw'>=</span> <span class='no'>sum</span>,
  <span class='kw'>prop_by_area</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/ifelse'>ifelse</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/identical'>identical</a></span>(<span class='no'>FUN</span>, <span class='no'>mean</span>) <span class='kw'>==</span> <span class='fl'>FALSE</span>, <span class='fl'>TRUE</span>, <span class='fl'>FALSE</span>),
  <span class='kw'>digits</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/options'>getOption</a></span>(<span class='st'>"digits"</span>))</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>flow</th>
      <td><p>A data frame representing the flow between two points
or zones. The first two columns of this data frame should correspond
to the first column of the data in the zones. Thus in <code><a href='cents.html'>cents()</a></code>,
the first column is geo_code. This corresponds to the first two columns
of <code><a href='flow.html'>flow()</a></code>.</p></td>
    </tr>
    <tr>
      <th>zones</th>
      <td><p>A spatial object representing origins (and destinations
if no separate destinations object is provided) of travel.</p></td>
    </tr>
    <tr>
      <th>aggzones</th>
      <td><p>A SpatialPolygonsDataFrame containing the new
boundaries to aggregate to.</p></td>
    </tr>
    <tr>
      <th>aggzone_points</th>
      <td><p>Points representing origins of OD flows
(typically population-weighted centroids)</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>A character vector containing the names of columns on which to
apply FUN. By default, all numeric columns are aggregated.</p></td>
    </tr>
    <tr>
      <th>aggcols</th>
      <td><p>A character vector containing the names of columns in
aggzones to retain in the aggregated data.frame. By default,
only the first column is retained. These columns are renamed with a prefix
of "o_" and "d_".</p></td>
    </tr>
    <tr>
      <th>FUN</th>
      <td><p>Function to use on aggregation. Default is sum.</p></td>
    </tr>
    <tr>
      <th>prop_by_area</th>
      <td><p>Boolean value indicating if the values should be
proportionally adjusted based on area. Default is TRUE unless FUN = mean.</p></td>
    </tr>
    <tr>
      <th>digits</th>
      <td><p>The number of digits to use when proportionally adjusting
values based on area. Default is the value of getOption("digits").</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>data.frame containing the aggregated od flows.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    
    <p>Origin-destination ('OD') flow data is often provided
in the form of 1 line per flow with zone codes of origin and destination
centroids. This function aggregates OD flows between polygon geometries
allocating the original flows to larger zones based on area.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other od: <code><a href='od2line.html'>od2line</a></code>,
  <code><a href='od_coords2line.html'>od_coords2line</a></code>, <code><a href='od_coords.html'>od_coords</a></code>,
  <code><a href='od_dist.html'>od_dist</a></code>, <code><a href='sp_aggregate.html'>sp_aggregate</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>zones</span>$<span class='no'>quadrant</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>1</span>, <span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span>, <span class='fl'>7</span>, <span class='fl'>1</span>)
<span class='no'>aggzones</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>rgeos</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/rgeos/topics/topo-bin-gUnion'>gUnaryUnion</a></span>(<span class='no'>zones</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='no'>zones</span>@<span class='kw'>data</span>$<span class='no'>quadrant</span>)
<span class='no'>aggzones</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>sp</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/sp/topics/SpatialPolygons'>SpatialPolygonsDataFrame</a></span>(<span class='no'>aggzones</span>, <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/data.frame'>data.frame</a></span>(<span class='kw'>region</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>:<span class='fl'>6</span>)), <span class='kw'>match.ID</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='kw pkg'>sp</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/sp/topics/is.projected'>proj4string</a></span>(<span class='no'>aggzones</span>) <span class='kw'>&lt;-</span> <span class='kw pkg'>sp</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/sp/topics/is.projected'>proj4string</a></span>(<span class='no'>zones</span>)
<span class='no'>aggzones_sf</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>sf</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/sf/topics/st_as_sf'>st_as_sf</a></span>(<span class='no'>aggzones</span>)
<span class='no'>aggzones_sf</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>sf</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/sf/topics/st_crs'>st_set_crs</a></span>(<span class='no'>aggzones_sf</span>, <span class='kw pkg'>sf</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/sf/topics/st_crs'>st_crs</a></span>(<span class='no'>zones_sf</span>))
<span class='no'>od_agg</span> <span class='kw'>&lt;-</span> <span class='fu'>od_aggregate</span>(<span class='no'>flow</span>, <span class='no'>zones_sf</span>, <span class='no'>aggzones_sf</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid assumes attributes are constant over geometries of x</span></div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid does not give correct centroids for longitude/latitude data</span></div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid assumes attributes are constant over geometries of x</span></div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid does not give correct centroids for longitude/latitude data</span></div><div class='output co'>#&gt; <span class='message'>although coordinates are longitude/latitude, st_intersects assumes that they are planar</span></div><div class='output co'>#&gt; <span class='message'>Joining, by = "Area.of.residence"</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Column `Area.of.residence` joining character vector and factor, coercing into character vector</span></div><div class='output co'>#&gt; <span class='message'>Joining, by = "Area.of.workplace"</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Column `Area.of.workplace` joining character vector and factor, coercing into character vector</span></div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/colSums'>colSums</a></span>(<span class='no'>od_agg</span>[<span class='fl'>3</span>:<span class='fl'>9</span>]) <span class='kw'>==</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/colSums'>colSums</a></span>(<span class='no'>flow</span>[<span class='fl'>3</span>:<span class='fl'>9</span>])</div><div class='output co'>#&gt;                                  All          Work.mainly.at.or.from.home 
#&gt;                                 TRUE                                 TRUE 
#&gt; Underground..metro..light.rail..tram                                Train 
#&gt;                                 TRUE                                 TRUE 
#&gt;                Bus..minibus.or.coach                                 Taxi 
#&gt;                                 TRUE                                 TRUE 
#&gt;         Motorcycle..scooter.or.moped 
#&gt;                                 TRUE </div><div class='input'><span class='no'>od_sf_agg</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='od2line.html'>od2line</a></span>(<span class='no'>od_agg</span>, <span class='no'>aggzones_sf</span>)</div><div class='output co'>#&gt; <span class='message'>Creating centroids representing desire line start and end points.</span></div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid assumes attributes are constant over geometries of x</span></div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid does not give correct centroids for longitude/latitude data</span></div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>flowlines</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='no'>flowlines</span>$<span class='no'>Bicycle</span>)</div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>od_sf_agg</span>$<span class='no'>geometry</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='no'>od_sf_agg</span>$<span class='no'>Bicycle</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>"red"</span>)</div><div class='img'><img src='od_aggregate-1.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div>
  <p>stplanr is a part of <img src='https://github.com/ropensci/logos/raw/master/icon_lettering_color.png' height=40 alt = 'rOpenSci'>. Learn more at <a href="https://ropensci.org">ropensci.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by Robin Lovelace, Richard Ellison.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>
      </footer>
   </div>

  

  </body>
</html>

