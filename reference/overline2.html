<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Convert series of overlapping lines into a route network (new method) — overline2 • stplanr</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />
<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>



<!-- Bootstrap -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>

<!-- ropensci -->
<link href="../ropensci.css" rel="stylesheet">

<meta property="og:title" content="Convert series of overlapping lines into a route network (new method) — overline2" />

<meta property="og:description" content="This function is intended as a replacement for overline() and is significantly faster
especially on large datasets. However, it also uses more memory." />

<meta property="og:image" content="https://ropensci.github.io/stplanr/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-462421-8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-462421-8');
</script>
  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://ropensci.org"><img src="../hexlogo.png" id="hexlogo" alt="rOpenSci" /></a>
        <a class="navbar-brand" href="../index.html"><i>stplanr <small>v0.2.10.9000</small></i></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/stplanr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/stplanr-od.html">Origin-destination data with stplanr</a>
    </li>
    <li>
      <a href="../articles/stplanr-paper.html">stplanr: A Package for Transport Planning</a>
    </li>
    <li>
      <a href="../articles/stplanr-route-nets.html">Route networks with stplanr</a>
    </li>
    <li>
      <a href="../articles/stplanr-routing.html">Transport routing with stplanr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ropensci/stplanr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Convert series of overlapping lines into a route network (new method)</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/stplanr/blob/master/R/overline.R'><code>R/overline.R</code></a></small>
    <div class="hidden name"><code>overline2.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>This function is intended as a replacement for overline() and is significantly faster
especially on large datasets. However, it also uses more memory.</p>
    
    </div>

    <pre class="usage"><span class='fu'>overline2</span>(<span class='no'>x</span>, <span class='no'>attrib</span>, <span class='kw'>ncores</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>simplify</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>regionalise</span> <span class='kw'>=</span> <span class='fl'>1e+05</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>An SF data.frame of LINESTRINGS</p></td>
    </tr>
    <tr>
      <th>attrib</th>
      <td><p>character, column names in x to be summed</p></td>
    </tr>
    <tr>
      <th>ncores</th>
      <td><p>integer, how many cores to use in parallel processing, default = 1</p></td>
    </tr>
    <tr>
      <th>simplify</th>
      <td><p>logical, if TRUE group final segments back into lines, default = TRUE</p></td>
    </tr>
    <tr>
      <th>regionalise</th>
      <td><p>integer, during simplification regonalisation is used if the number of segments exceeds this value</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An SF data.frame of LINESTRINGS</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The overline2 function breaks each line into many straight segments and then looks for duplicated segments.
Attributes are summed for all duplicated segments, and if simplify is TRUE the segments with identical attributes are
recombined into linestrings.</p>
<p>Regionalisation breaks the dataset into a 10 x 10 grid and then performed the simplification across each grid.
This significantly reduces computation time for large datasets, but slightly increases the final file size.
For smaller datasets it increases computation time slightly but reduces memory usage and so may also be useful.</p>
<p>A known limitation of this method is that overlapping segments of different lengths are not aggregated.
This can occur when lines stop halfway down a road. Typically these errors are small,
but some artefacts may remain within the resulting data.</p>
<p>For very large datasets nrow(x) &gt; 1000000, memory usage can be significant. In these cases is is possible
to overline subsets of the dataset, rbind the results together, and then overline again, to produce
a final result.</p>
<p>Multicore support is only enabled for the regionalised simplification stage as it does not help with other stages.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other rnet: <code><a href='SpatialLinesNetwork.html'>SpatialLinesNetwork</a></code>,
  <code><a href='calc_catchment_sum.html'>calc_catchment_sum</a></code>,
  <code><a href='calc_catchment.html'>calc_catchment</a></code>,
  <code><a href='calc_moving_catchment.html'>calc_moving_catchment</a></code>,
  <code><a href='calc_network_catchment.html'>calc_network_catchment</a></code>,
  <code><a href='find_network_nodes.html'>find_network_nodes</a></code>, <code><a href='gsection.html'>gsection</a></code>,
  <code><a href='islines.html'>islines</a></code>, <code><a href='lineLabels.html'>lineLabels</a></code>,
  <code><a href='overline.html'>overline</a></code>,
  <code><a href='plot-SpatialLinesNetwork-ANY-method.html'>plot,SpatialLinesNetwork,ANY-method</a></code>,
  <code><a href='plot-sfNetwork-ANY-method.html'>plot,sfNetwork,ANY-method</a></code>,
  <code><a href='sln2points.html'>sln2points</a></code>,
  <code><a href='sum_network_links.html'>sum_network_links</a></code>,
  <code><a href='sum_network_routes.html'>sum_network_routes</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>sl</span> <span class='kw'>=</span> <span class='no'>routes_fast_sf</span>[<span class='no'>routes_fast_sf</span>$<span class='no'>length</span> <span class='kw'>&gt;</span> <span class='fl'>0</span>, ]
<span class='no'>sl</span>$<span class='no'>bicycle</span> <span class='kw'>=</span> <span class='fl'>1</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.time'>system.time</a></span>({<span class='no'>rnet1</span> <span class='kw'>=</span> <span class='fu'>overline2</span>(<span class='no'>sl</span>, <span class='st'>"bicycle"</span>)})</div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:37 constructing segments</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:37 building geometry</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:37 simplifying geometry</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:37 aggregating flows</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:37 rejoining segments into linestrings</span></div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.108   0.000   0.109 </div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.time'>system.time</a></span>({<span class='no'>rnet2</span> <span class='kw'>=</span> <span class='fu'>overline2</span>(<span class='no'>sl</span>, <span class='st'>"bicycle"</span>, <span class='kw'>ncores</span> <span class='kw'>=</span> <span class='fl'>4</span>)})</div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:37 constructing segments</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:37 building geometry</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:37 simplifying geometry</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:37 aggregating flows</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:37 rejoining segments into linestrings</span></div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.164   0.000   0.163 </div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/identical'>identical</a></span>(<span class='no'>rnet1</span>, <span class='no'>rnet2</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='no'>lwd</span> <span class='kw'>=</span> <span class='no'>rnet1</span>$<span class='no'>bicycle</span> / <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/mean'>mean</a></span>(<span class='no'>rnet1</span>$<span class='no'>bicycle</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>rnet1</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='no'>lwd</span>)</div><div class='img'><img src='overline2-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='no'>region</span> <span class='kw'>=</span> <span class='st'>"isle-of-wight"</span>

<span class='no'>u</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/paste'>paste0</a></span>(
  <span class='st'>"https://github.com/npct/pct-outputs-regional-notR/raw/master/commute/msoa/"</span>,
   <span class='no'>region</span>,
  <span class='st'>"/rf.geojson"</span>
)

<span class='no'>sl</span> <span class='kw'>=</span> <span class='kw pkg'>sf</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/sf/topics/st_read'>read_sf</a></span>(<span class='no'>u</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.time'>system.time</a></span>({<span class='no'>rnet1</span> <span class='kw'>=</span> <span class='fu'>overline2</span>(<span class='no'>sl</span>, <span class='st'>"bicycle"</span>)})</div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:39 constructing segments</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:39 building geometry</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:39 simplifying geometry</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:39 aggregating flows</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:40 rejoining segments into linestrings</span></div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.816   0.008   0.824 </div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.time'>system.time</a></span>({<span class='no'>rnet2</span> <span class='kw'>=</span> <span class='fu'>overline2</span>(<span class='no'>sl</span>, <span class='st'>"bicycle"</span>, <span class='kw'>ncores</span> <span class='kw'>=</span> <span class='fl'>4</span>)})</div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:40 constructing segments</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:40 building geometry</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:41 simplifying geometry</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:41 aggregating flows</span></div><div class='output co'>#&gt; <span class='message'>2019-07-07 06:10:41 rejoining segments into linestrings</span></div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.788   0.004   0.790 </div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/identical'>identical</a></span>(<span class='no'>rnet1</span>, <span class='no'>rnet2</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='no'>lwd</span> <span class='kw'>=</span> <span class='no'>rnet1</span>$<span class='no'>bicycle</span> / <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/mean'>mean</a></span>(<span class='no'>rnet1</span>$<span class='no'>bicycle</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>rnet1</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='no'>lwd</span>)</div><div class='img'><img src='overline2-2.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Malcolm Morgan</p>
  </div>
</div>

      <footer>
      <div style="margin-top:-9px">
  <p>stplanr is a part of <img src='https://github.com/ropensci/logos/raw/master/icon_lettering_color.png' height=40 alt = 'rOpenSci'>. Learn more at <a href="https://ropensci.org">ropensci.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by Robin Lovelace, Richard Ellison, Malcolm Morgan.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a> & <a href="https://docs.ropensci.org/rotemplate/">rotemplate</a>.
  </p>
</div>
      </footer>
   </div>

  

  </body>
</html>

